(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"/0GS":function(t,e,o){},"3Zg1":function(t,e,o){"use strict";o.r(e);var a=o("TbGu"),i=o.n(a),n=(o("eFdw"),o("b0p+")),s=o.n(n),c=o("3eXy"),r=o("zWze"),l=(o("v5wO"),o("Yfch")),h=o("nQ0s"),u={components:{aqmAccountinfo:s.a.aqmAccountinfo,aqmPiechart:s.a.aqmPiechart,aqmAgreecheck:s.a.aqmAgreecheck,aqmState:s.a.aqmState,aqmPiestate:s.a.aqmPiestate,aqmNavbar:s.a.aqmNavbar,aqmCollapse:s.a.aqmCollapse,aqmCategoryL1:s.a.aqmCategoryL1,aqmShowpanel:s.a.aqmShowpanel,aqmSelectButton:s.a.aqmSelectButton,aqmVuxCheckIcon:s.a.aqmVuxCheckIcon,aqmTransferPopcard:s.a.aqmTransferPopcard},mixins:[r.a],data:function(){return{accountInfo:[{title:this.$t("m_allocation.annual_profit"),value:"--",type:1}],checkValue:!1,title:this.$t("m_allocation.recommend_allocation"),titleTips1:this.$t("m_allocation.test_result"),titleTips2:this.$t("m_allocation.recommend_allocation1"),titleTips3:this.$t("m_allocation.recommend_allocation2"),transferTips:"".concat(this.$t("hst.allocation_transfer_min"),"100,000.00").concat(this.$t("hst.allocation_transfer_hkd")),riskNameMap:{1:this.$t("result.risktype_1"),2:this.$t("result.risktype_2"),3:this.$t("result.risktype_3"),4:this.$t("result.risktype_4"),5:this.$t("result.risktype_5")},recommandReason:{1:this.$t("m_invest_type.RiskProfileRiskReason_1"),2:this.$t("m_invest_type.RiskProfileRiskReason_2"),3:this.$t("m_invest_type.RiskProfileRiskReason_3"),4:this.$t("m_invest_type.RiskProfileRiskReason_4"),5:this.$t("m_invest_type.RiskProfileRiskReason_5")},riskType:"",detail:this.$t("m_allocation.allocation_detail"),stockData:[],bondData:[],otherData:[],pieData:"",percentList:[],stockCg:this.$t("portfolio.stock"),bondCg:this.$t("portfolio.bond"),otherCg:this.$t("portfolio.other"),nameCode:this.$t("m_allocation.name_code"),reasonTitle:this.$t("m_allocation.recommend_reason"),adviceAmout:"",cashType:"HKD",region:"HK",adviceQuestion:[],expectMoney:1e5,inputFlag:!1,hsAmount:"",iaccountAmount:"",showChange:!0,showPopCard:!1,inputValue:"",hasPortfolio:!1,showBack:!0,canClick:!0,fromRiskMent:!1}},computed:{},watch:{},methods:{init:function(){var e=this;(this.$store.state.isHKUS||this.$store.state.isUS)&&(this.cashType="USD",this.region="US");var o,a=this;c.a.getAdviceActive(null).then(function(t){t&&0===t.length&&e.$alertBox(e.$t("m_allocation.no_advice")),sessionStorage.getItem("fromQuestion")?e.adviceQuestion=e.adviceFilter(t,202100,202200):e.adviceQuestion=e.adviceFilter.apply(e,[t,202100].concat(i()(h.c))),e.adviceQuestion&&0<e.adviceQuestion.length&&(o=e.adviceQuestion[0]),o&&(a.adviceAmout=o.amount,a.riskType=o.riskType,a.target=o.target,a.riskIndex=a.riskRatio,a.accountInfo[0].value=100*o["5y_return"]),c.a.getCash().then(function(t){e.hsAmount=+t.HsAmount,e.iaccountAmount=+t.iaccountAmount,e.iaccountAmount?e.showChange=!0:e.showBack=!1,202100==o.type&&"fromPortfolio"!==localStorage.getItem("fromPortfolio")&&(e.showBack=!1),e.fromRiskMent||(e.expectMoney=1e5<t.iaccountAmount?t.iaccountAmount:1e5),c.a.getPortfolio().then(function(t){t.id&&t.status<2e5&&(e.expectMoney=+t.value,e.showChange=!1,e.hasPortfolio=!0),e.getEtfDetail(e.target,e.expectMoney)}).catch(function(t){e.handleError(t)})}).catch(function(t){e.handleError(t)})}).catch(function(t){e.handleError(t)})},getEtfDetail:function(t,e){var o=this;this.showETFDetail(t,e).then(function(t){o.stockData=t.stockData,o.bondData=t.bondData,o.otherData=t.otherData,o.pieData=t.fundsValue,o.percentList=o.computePiePercent(t,e),setTimeout(function(){o&&o.$refs&&o.$refs.pieChart&&o.$refs.pieChart.startDraw(o.pieData)},100)}).catch(function(t){o.handleError(t)})},onChange:function(){var t=this;this.$nextTick(function(){t.inputValue=t.formatValue(t.inputValue)})},blur:function(){this.inputFlag=!1,Object(l.a)(this.expectMoney.toString())?this.expectMoney<1e5?this.$vux.toast.show({text:this.$t("hst.toast6"),type:"text",width:"300px"}):this.getEtfDetail(this.target,this.expectMoney):this.$vux.toast.show({text:this.$t("transfer.money_not_valid"),type:"text",width:"300px"})},doFocus:function(){document.getElementById("money-input").focus()},changMoney:function(){this.inputFlag=!0,document.getElementById("money-input").focus()},cardClose:function(){this.showPopCard=!1},reQuestion:function(){this.$router.push({path:"/question",query:{type:"first"}})},goRiskState:function(){localStorage.setItem("firstExpectMoney",this.expectMoney),this.$router.push("/riskagreement")},onRadioChange:function(t){console.log("radio onchange data:".concat(t)),console.log("radio model data:".concat(this.radioModel))},postAllocation:function(){var e=this,o=null,a=null;if(this.adviceQuestion.forEach(function(t){202100===t.type&&(o=t.id),202200===t.type?a=t.id:301300===t.type?a=t.id:301100===t.type&&(a=t.id)}),console.log(a),o){var t={amount:this.expectMoney};c.a.putAdviceAmount(o,t).then(function(t){e.$vux.loading.hide(),e.$router.push("/order"),console.log(t)}).catch(function(t){e.handleError(t)})}else{var i={answer:localStorage.getItem("answer"),persist:1};c.a.postAdviceAnswer(i,a).then(function(){c.a.postAdviceConfirm(a).then(function(t){console.log(t),c.a.getAdviceActive().then(function(t){e.$vux.loading.hide(),t.length?e.$router.push("/transferposition"):e.$router.push("/portfolio")}).catch(function(t){e.handleError(t)})}).catch(function(t){e.$vux.loading.hide(),e.handleError(t)})}).catch(function(t){e.$vux.loading.hide(),e.handleError(t)})}},confirmAllocation:function(){if(this.hasPortfolio)this.postAllocation();else{if(!Object(l.a)(this.expectMoney.toString()))return void this.$vux.toast.show({text:this.$t("transfer.money_not_valid"),type:"text",width:"300px"});if(+this.expectMoney<1e5)return void this.$vux.toast.show({text:this.$t("hst.toast6"),type:"text",width:"300px"});if(+this.expectMoney>this.hsAmount+this.iaccountAmount){var t=this;return void this.$vux.confirm.show({title:this.$t("hst.allocation_insufficient"),content:this.$t("hst.allocation_insufficient_desc"),cancelText:this.$t("hst.allocation_insufficient_back"),confirmText:this.$t("hst.allocation_insufficient_deposit"),onCancel:function(){},onConfirm:function(){t.$router.push("/cashguide")}})}if(+this.expectMoney>this.iaccountAmount){this.showPopCard=!0;var e=(this.expectMoney-this.iaccountAmount).toFixed(2);return this.transferTips="".concat(this.$t("hst.allocation_transfer_min")).concat(e).concat(this.$t("hst.allocation_transfer_hkd")),void(this.inputValue=e)}this.$vux.loading.show({text:"Loading"}),this.postAllocation()}},confirmTransfer:function(){var e=this;if(this.canClick){if(!Object(l.a)(this.inputValue.toString()))return void this.$vux.toast.show({text:this.$t("transfer.money_not_valid"),type:"text",width:"300px"});if(this.inputValue=+this.inputValue,!this.inputValue)return void this.$vux.toast.show({text:"请输入划转金额",type:"text",width:"200px"});var t=(this.expectMoney-this.iaccountAmount).toFixed(2);if(+this.inputValue<t)return void this.$vux.toast.show({text:"".concat(this.$t("hst.allocation_transfer_min")).concat(t).concat(this.$t("hst.allocation_transfer_hkd")),type:"text",width:"300px"});if(+this.inputValue>this.hsAmount)return void this.$vux.toast.show({text:this.$t("hst.toast7"),type:"text",width:"300px"});this.$vux.loading.show({text:"Loading"}),this.canClick=!1,setTimeout(function(){this.canClick=!0},2e3),c.a.getCashIn(this.inputValue).then(function(t){t.flag&&(console.log(e.hasCashIn,"2222"),e.postAllocation())}).catch(function(t){e.$vux.loading.hide(),t&&t.status&&10117==t.status.ecode?e.$vux.alert.show({title:"",content:e.$t("hst.err_10117"),buttonText:e.$t("info.confirm"),onShow:function(){console.log("Plugin: I'm showing")},onHide:function(){}}):e.handleError(t)})}}},mounted:function(){var t=this;this.$nextTick(function(){t.init()}),document.addEventListener("touchstart",function(){},!0)},beforeRouteEnter:function(t,e,o){"/question"===e.path?sessionStorage.setItem("fromQuestion",!0):"/riskagreement"===e.path?console.log("from:============",e):sessionStorage.removeItem("fromQuestion"),o(function(t){console.log("from:============",e),"/riskagreement"===e.path&&(t.expectMoney=localStorage.getItem("firstExpectMoney"),t.fromRiskMent=!0,localStorage.removeItem("firstExpectMoney")),"/portfolio"===e.path&&localStorage.setItem("fromPortfolio","fromPortfolio")})},beforeDestroy:function(){document.removeEventListener("touchstart",function(){},!0)}},p=(o("i88w"),o("KHd+")),m=Object(p.a)(u,function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"allocation-page"},[o("aqmNavbar",{attrs:{showBack:!1,showClose:!0,value:e.title,showHelp:!0},on:{goBack:e.emitBack,close:e.emitClose,goHelp:e.goFaq}}),e._v(" "),o("div",{staticClass:"title-tips"},[e._v(e._s(e.titleTips1)),o("span",[e._v(e._s(e.riskNameMap[e.riskType]))]),e._v(e._s(e.titleTips2)),o("span",[e._v(e._s(e.riskNameMap[e.riskType]))]),e._v(e._s(e.$t("m_allocation.recommend_allocation2_hst"))+"\n    "),o("a",{staticClass:"re-question",on:{click:e.reQuestion}},[e._v(e._s(e.$t("portfolio.re_question")))])]),e._v(" "),o("div",{staticClass:"card-container"},[o("div",{staticClass:"account-info"},[o("div",{staticClass:"expect-money"},[o("p",[e._v(e._s(e.$t("m_allocation.expected_invest_amount")))]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.inputFlag,expression:"!inputFlag"}],staticClass:"input-cont",on:{click:e.changMoney}},[e._v(e._s(e._f("formatMoney")(e.expectMoney)))]),e._v(" "),o("div",{staticClass:"input-money-wrap",class:{"input-show":e.inputFlag}},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.expectMoney,expression:"expectMoney"}],attrs:{type:"text",id:"money-input"},domProps:{value:e.expectMoney},on:{blur:e.blur,input:function(t){t.target.composing||(e.expectMoney=t.target.value)}}})]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:e.showChange,expression:"showChange"}],staticClass:"change-money",on:{click:e.changMoney}},[e._v(e._s(e.$t("hst.allocation_modify")))])])]),e._v(" "),o("aqmAccountinfo",{attrs:{accountInfo:e.accountInfo}}),e._v(" "),o("div",{staticClass:"risk-tips"},[o("p",[e._v(e._s(e.$t("m_allocation.risk_tips")))])])],1),e._v(" "),o("div",{staticClass:"card-container"},[o("aqmCollapse",{staticClass:"reason-title"},[o("aqmCategoryL1",{attrs:{slot:"title",categoryText:e.reasonTitle,underline:!1},slot:"title"}),e._v(" "),o("span",{attrs:{slot:"text"},slot:"text"},[e._v("\n           "+e._s(e.recommandReason[e.riskType])+"\n      ")])],1)],1),e._v(" "),o("div",{staticClass:"card-container"},[o("aqmCategoryL1",{attrs:{categoryText:e.detail,underline:!1}}),e._v(" "),o("div",[o("aqmPiechart",{ref:"pieChart",staticClass:"pie-chart",attrs:{typeName:e.riskNameMap[e.riskType],type:e.$t("m_invest_type.risk_type"),size:140}}),e._v(" "),o("div",{staticClass:"pie-state"},[o("aqmPiestate",{attrs:{items:e.percentList}})],1)],1),e._v(" "),o("div",{staticClass:"recommand-list"},[o("aqmShowpanel",{attrs:{currency:e.cashType,region:e.region,itemMoney:e.$t("m_invest_type.cash_amount"),items:e.stockData,itemType:e.stockCg,itemNum:e.nameCode}}),e._v(" "),o("aqmShowpanel",{attrs:{currency:e.cashType,region:e.region,itemMoney:e.$t("m_invest_type.cash_amount"),items:e.bondData,itemType:e.bondCg,itemNum:e.nameCode}}),e._v(" "),o("aqmShowpanel",{attrs:{currency:e.cashType,region:e.region,itemMoney:e.$t("m_invest_type.cash_amount"),items:e.otherData,itemType:e.otherCg,itemNum:e.nameCode}})],1),e._v(" "),o("aqmState",{attrs:{stateName:e.$t("m_allocation.statement"),content:e.$t("m_allocation.statement_content")}}),e._v(" "),o("div",{staticClass:"btn-agree-wrap"},[o("aqm-vux-check-icon",{attrs:{value:e.checkValue},on:{"update:value":function(t){e.checkValue=t}}},[o("span",[e._v(e._s(e.$t("m_allocation.state_read")))]),e._v(" "),o("span",{staticClass:"link",on:{click:e.goRiskState}},[e._v(e._s(e.$t("m_allocation.risk_state")))]),e._v(" "),o("span",[e._v(e._s(e.$t("m_allocation.state_agree")))])])],1),e._v(" "),o("aqmSelectButton",{staticClass:"order-btn",attrs:{disabled:!e.checkValue,value:e.$t("transferPosition.confirm_allocation"),fontSize:16,height:43,borderRadius:5},on:{click:e.confirmAllocation}})],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopCard,expression:"showPopCard"}],staticClass:"mask-bg"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopCard,expression:"showPopCard"}],staticClass:"pop-card-container"},[o("aqmTransferPopcard",{attrs:{inputValue:e.inputValue,unit:e.$t("portfolio.hkd"),cardTitle:e.$t("hst.allocation_transfer"),cardText:e.$t("hst.allocation_transfer_desc"),onCardClose:e.cardClose,tips:e.transferTips,buttonText:e.$t("hst.allocation_transfer_confirm")},on:{onChange:e.onChange,"update:inputValue":function(t){e.inputValue=t},"update:input-value":function(t){e.inputValue=t},confirm:e.confirmTransfer}})],1)])],1)},[],!1,null,null,null);e.default=m.exports},Yfch:function(t,e,o){"use strict";o.d(e,"a",function(){return a});o("6BQ9");function a(t){return!(t&&!t.match(/^\d+(\.\d+)?$/))}},i88w:function(t,e,o){"use strict";var a=o("/0GS");o.n(a).a}}]);